<h2>{{ survey?.title }}</h2>
<!--<p>{{ survey?.description }}</p>-->
<div class="form-group">
  <label for="description">Опис опитування</label><br>
  <textarea id="description" [(ngModel)]="survey!.description" name="description" class="form-control"></textarea>
</div>
<div>
  <label>
    <input type="checkbox" [(ngModel)]="survey!.public" />
    Публічне опитування
  </label>
</div>

<div>
  <label>
    <input type="checkbox" [(ngModel)]="survey!.requireAuth" />
    Потребує авторизації
  </label>
</div>
<div *ngFor="let q of survey?.questions; let i = index" class="question-block">
  

  <div *ngIf="editedIndex !== i">
    <p><strong>Питання {{ i + 1 }}:</strong> {{ q.text }} ({{ q.type }})</p>
    <ul>
      <li *ngFor="let opt of q.options">{{ opt.text }}</li>
    </ul>
    <button [disabled]="!q.canEdit" (click)="editQuestion(i)">Редагувати</button>
  </div>
     <div *ngIf="!q.canEdit" class="text-danger">
    Неможливо редагувати: на питання вже були надані відповіді.
  </div>

  <div *ngIf="editedIndex === i">
    <input [(ngModel)]="editableQuestion.text" placeholder="Текст питання" />
    <select [(ngModel)]="editableQuestion.type">
      <option value="TEXT">Текстове</option>
      <option value="SINGLE_CHOICE">Один варіант</option>
      <option value="MULTIPLE_CHOICE">Кілька варіантів</option>
    </select>

    <div *ngIf="editableQuestion.type !== 'TEXT'">
      <div *ngFor="let opt of editableQuestion.options; let j = index">
        <input [(ngModel)]="editableQuestion.options[j].text" placeholder="Варіант відповіді" />
        <button (click)="removeOption(j)">Видалити</button>
      </div>
      <button (click)="addOption()">Додати варіант</button>
    </div>

    <button (click)="saveQuestion(i, q.id)">Зберегти</button>
    <button (click)="cancelEdit()">Скасувати</button>

 
  </div>

  <hr />

</div>

<div>
  <button (click)="showNewQuestionForm()">Додати питання</button>
</div>

<div *ngIf="newQuestionVisible" class="new-question-form">
  <input [(ngModel)]="newQuestion.text" placeholder="Текст питання" />
  <select [(ngModel)]="newQuestion.type">
    <option value="TEXT">Текстове</option>
    <option value="SINGLE_CHOICE">Один варіант</option>
    <option value="MULTIPLE_CHOICE">Кілька варіантів</option>
  </select>

  <div *ngIf="newQuestion.type !== 'TEXT'">
    <div *ngFor="let opt of newQuestion.options; let j = index">
      <input [(ngModel)]="opt.text" placeholder="Варіант відповіді" />
      <button (click)="removeNewOption(j)">Видалити</button>
    </div>
    <button (click)="addNewOption()">Додати варіант</button>
  </div>

  <button (click)="saveNewQuestion()">Зберегти питання</button>
</div>


<button class="btn btn-success mt-3" (click)="saveSurveyChanges()">Зберегти зміни</button>
<button *ngIf="survey?.isActive" class="btn btn-danger" (click)="finishSurvey()">Завершити опитування</button>

