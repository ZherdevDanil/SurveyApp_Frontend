<!-- survey-pass.component.html -->

<!-- Стан завантаження -->
<div *ngIf="loading">
  <p>Завантаження...</p>
</div>

<!-- 1. Опитування закінчено -->
<div *ngIf="surveyClosed" class="text-center mt-4">
  <h3>Опитування закінчено. Дякуємо, хто брав участь.</h3>
  <button class="btn btn-primary mt-3" (click)="router.navigate(['/'])">
    Повернутися на головну
  </button>
</div>

<!-- 2. Вже проходили -->
<div *ngIf="!loading && !surveyClosed && alreadySubmitted" class="text-center mt-4">
  <h3>Ви вже проходили це опитування. Дякуємо!</h3>
  <button class="btn btn-primary mt-3" (click)="router.navigate(['/'])">
    Повернутися на головну
  </button>
</div>

<!-- 3. Форма для проходження опитування -->
<form
  *ngIf="!loading && !surveyClosed && !alreadySubmitted"
  (ngSubmit)="submitAnswers()"
  class="survey-form"
>
  <h2 class="mb-4">{{ survey?.title }}</h2>
  <p class="mb-4" *ngIf="survey?.description">{{ survey?.description }}</p>

  <div *ngFor="let q of survey?.questions; let i = index" class="mb-4 question-block">
    <h4>Питання {{ i + 1 }}: {{ q.text }}</h4>

    <!-- Текстове питання -->
    <div *ngIf="q.type === 'TEXT'">
      <input
        type="text"
        class="form-control"
        [(ngModel)]="answers[q.id]"
        name="textAnswer{{ q.id }}"
        placeholder="Ваша відповідь…"
      />
    </div>

    <!-- Одиночний вибір -->
    <div *ngIf="q.type === 'SINGLE_CHOICE'">
      <div *ngFor="let opt of q.options" class="form-check">
        <label class="form-check-label">
          <input
            type="radio"
            class="form-check-input"
            [name]="'radio' + q.id"
            [value]="opt.id"
            [(ngModel)]="answers[q.id]"
          />
          {{ opt.text }}
        </label>
      </div>
      <div
        *ngIf="!answers[q.id]"
        class="text-danger mt-2"
      >
        Будь ласка, виберіть хоча б один варіант.
      </div>
    </div>

    <!-- Множинний вибір -->
    <div *ngIf="q.type === 'MULTIPLE_CHOICE'">
      <div *ngFor="let opt of q.options" class="form-check">
        <label class="form-check-label">
          <input
            type="checkbox"
            class="form-check-input"
            [checked]="answers[q.id]?.includes(opt.id)"
            (change)="onCheckboxChangeEvent(q.id, opt.id, $event)"
          />
          {{ opt.text }}
        </label>
      </div>
      <div
        *ngIf="(!answers[q.id] || answers[q.id].length === 0)"
        class="text-danger mt-2"
      >
        Будь ласка, виберіть хоча б один варіант.
      </div>
    </div>
  </div>

  <button type="submit" class="btn btn-primary" [disabled]="!canSubmit()">Надіслати відповіді</button>
</form>
